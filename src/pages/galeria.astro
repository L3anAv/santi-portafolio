---
import Layout from '../layouts/Layout.astro';
import Menu from '../components/menu.astro';

const menuIndex ={
    fotos: { href: '/galeria?type=photo', label: 'Fotografía'},
    video: { href: '/galeria?type=video', label: 'Audiovisual'},
};

const menuFoto = {
  inicio: { href: '/inicio', label: 'Home'},
  fotos: { href: '/galeria?type=photo', label: 'Fotografía'},
}

const menuVideo = {
  inicio: { href: '/inicio', label: 'Home'},
  video: { href: '/galeria?type=video', label: 'Audiovisual'},
}

const slideVertical = {
  forwards: {
    old: [{ name: 'subir-y-salir', duration: '0.6s', easing: 'ease' }],
    new: [{ name: 'subir-y-entrar', duration: '0.6s', easing: 'ease-in-out' }]
  },
  backwards: {
    old: [{ name: 'bajar-y-salir', duration: '0.6s', easing: 'ease' }],
    new: [{ name: 'bajar-y-entrar', duration: '0.6s', easing: 'ease-in-out' }]
  }
};
---

<Layout title=" Galeria | Santiago Claros ">
  <div transition:name="inicio" transition:animate={slideVertical} class="container" id="galeria-root" data-type="loading">
    
    <div class="menu-wrapper" data-menu-type="initial">
      <Menu menuItems={menuIndex} />
    </div>

    <div class="menu-wrapper" data-menu-type="video">
      <Menu menuItems={menuFoto} />
    </div>

    <div class="menu-wrapper" data-menu-type="photo">
      <Menu menuItems={menuVideo} />
    </div>

    <div class="selection-screen">
      <h2>¿Qué te gustaría ver hoy?</h2>
    </div>

 <div class="foto-container">
      <div class="item"><img src="/images/1.jpg"></div>
      <div class="item"><img src="/images/2.jpg"></div>
      <div class="item"><img src="/images/3.jpg"></div>
      <div class="item"><img src="/images/4.jpg"></div>
      <div class="item"><img src="/images/3.jpg"></div>
      <div class="item"><img src="/images/4.jpg"></div>
      <div class="item"><img src="/images/3.jpg"></div>
      <div class="item"><img src="/images/4.jpg"></div>
      <div class="item"><img src="/images/3.jpg"></div>
      <div class="item"><img src="/images/2.jpg"></div>
      <div class="item"><img src="/images/1.jpg"></div>
      <div class="item"><img src="/images/2.jpg"></div>
      <div class="item"><img src="/images/1.jpg"></div>
      <div class="item"><img src="/images/2.jpg"></div>
      <div class="item"><img src="/images/1.jpg"></div>
    </div>

    <div class="video-container">
      <h2>Galería de Videos</h2>
    </div>

  </div>
</Layout>

<script>
  const checkUrl = () => {
    const params = new URLSearchParams(window.location.search);
    const type = params.get('type'); 
    const root = document.getElementById('galeria-root');

    if (root) {
      if (type === 'photo' || type === 'video') {
        root.dataset.type = type;
      } else {
        root.dataset.type = 'initial';
      }
    }
  };

  // Ejecutar al cargar
  checkUrl();

  // Escuchar cambios de navegación (Astro ViewTransitions y botones atrás/adelante)
  document.addEventListener('astro:after-swap', checkUrl);
  window.addEventListener('popstate', checkUrl);
</script>

<style>
  /* --- LÓGICA DE VISIBILIDAD DE MENÚS --- */
  .menu-wrapper {
    display: none; /* Ocultos por defecto */
  }

  .container[data-type="initial"] [data-menu-type="initial"] { display: block; }
  .container[data-type="photo"] [data-menu-type="photo"] { display: block; }
  .container[data-type="video"] [data-menu-type="video"] { display: block; }

  /* --- LÓGICA DE VISIBILIDAD DE CONTENIDOS --- */
  .selection-screen, .foto-container, .video-container {
    display: none;
  }

  .container[data-type="initial"] .selection-screen { display: block; }
  .container[data-type="photo"] .foto-container { display: grid; }
  .container[data-type="video"] .video-container { display: grid; }

  /* Estado de carga: oculta todo para evitar saltos visuales */
  .container[data-type="loading"] > div {
    display: none;
  }

  /* --- ESTILOS DE GRID (Pinterest Style) --- */
.container {
  display: flex;
  flex-direction: column;
  margin:0;
  padding:0;

  /* --- ACTIVAR SCROLL INTERNO --- */
  height: 100dvh;      /* El contenedor ocupa toda la pantalla */
  overflow-y: auto;    /* Permite el scroll vertical si el contenido excede el alto */
  overflow-x: hidden;  /* Evita el scroll horizontal molesto */

  /* Opcional: para que el scroll sea suave */
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch; /* Suavidad extra en iPhones */ 

  /* Ocultar barra en Chrome, Safari y Edge */
  &::-webkit-scrollbar {
    display: none;
  }

  /* Ocultar barra en Firefox */
  scrollbar-width: none;

  /* Ocultar barra en Internet Explorer/Edge antiguo */
  -ms-overflow-style: none;
}

.foto-container, 
.video-container {
    gap: 15px;
    width: 95%;
    padding: 15px;
    grid-auto-flow: dense;
    grid-auto-rows: 100px; 
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 300px), 1fr));
}

  .item {
    width: 100%;
    height: 100%;
    position: relative;
    border-radius: 15px;
    overflow: hidden;
    background-color: #f0f0f0;
    grid-row: span 2;
  }

.item:nth-child(2n) {
  grid-row: span 3;
}

.item:nth-child(3n) {
  grid-row: span 4;
}

.item:nth-child(5n) {
  grid-column: span 1;
} 

  .item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease-in-out;
  }

  .item:hover img {
    transform: scale(1.1);
    cursor: pointer;
  }
</style>